---
- name: Pull service facts
  ansible.builtin.service_facts:

- name: Load Agent Defaults
  ansible.builtin.include_vars: "agent_vars.yml"

- name: 'Remove | Make sure the "old" zabbix-agent service stopped'
  ansible.builtin.service:
    name: "{{ _agent_service }}"
    state: stopped
    enabled: false
  become: true
  when: |
    ansible_facts.services["zabbix-agent.service"] is defined or
    ansible_facts.services["zabbix-agent"] is defined

- name: "Remove | Package removal"
  ansible.builtin.package:
    name: "{{ _agent_package }}"
    state: absent
  become: true

- name: "Remove | Remove the agent-include-dir"
  ansible.builtin.file:
    path: "{{ _include }}"
    state: absent
  become: true
