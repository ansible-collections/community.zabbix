---
- name: Pull service facts
  service_facts:

- name: "Remove | Make sure the \"old\" zabbix-agent service is running"
  service:
    name: "zabbix-agent"
    state: stopped
    enabled: no
  become: yes
  when: |
    ansible_facts.services["zabbix-agent.service"] is defined or
    ansible_facts.services["zabbix-agent"] is defined

- name: "Remove | package removal"
  package:
    name: "zabbix-agent"
    state: absent
  become: yes

- name: "Remove | Remove the agent-include-dir"
  file:
    path: "{{ zabbix_agent_include }}"
    state: absent
  become: yes
