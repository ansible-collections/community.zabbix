---

- name: restart apache
  service:
    name: "{{ _apache_service }}"
    state: restarted
    enabled: true
  become: true
  when:
    - zabbix_websrv == 'apache'

- name: test nginx config
  listen: restart nginx
  command: nginx -t
  register: zabbix_nginx_cfg_check
  notify: restart nginx tested
  become: true
  when:
    - zabbix_websrv == 'nginx'

- name: restart nginx tested
  service:
    name: nginx
    state: restarted
    enabled: true
  become: true
  when:
    - zabbix_websrv == 'nginx'
    - zabbix_nginx_cfg_check.rc == 0

- name: restart redhat-php-fpm
  service:
    name: "{{ 'rh-php72-php-fpm' if zabbix_php_fpm else 'php-fpm' }}"
    state: restarted
    enabled: true
  become: true
  when:
    - zabbix_version is version('5.0', '>=')

- name: restart php-fpm-version
  service:
    name: php{{ zabbix_php_version }}-fpm
    state: restarted
    enabled: true
  become: true
  when:
    - zabbix_version is version('5.0', '>=')
