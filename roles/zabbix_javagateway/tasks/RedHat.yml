---
# Tasks specific for RedHat systems
- name: "RedHat | Import Zabbix gpg key"
  rpm_key:
    key: "{{ zabbix_repo_yum_gpg_key }}"
    state: present
  environment:
    http_proxy: "{{ zabbix_http_proxy | default(None) | default(omit) }}"
    https_proxy: "{{ zabbix_https_proxy | default(None) | default(omit) }}"
  register: zabbix_web_repo_files_installed
  until: zabbix_web_repo_files_installed is succeeded
  become: true
  when:
    - zabbix_repo == "zabbix"
  tags:
    - zabbix-web

- name: "RedHat | Add repo"
  package:
    name: "{{ zabbix_repo_yum_url }}"
    state: present
  environment:
    http_proxy: "{{ zabbix_http_proxy | default(None) | default(omit) }}"
    https_proxy: "{{ zabbix_https_proxy | default(None) | default(omit) }}"
  register: yum_repo_installed
  become: true
  when:
    zabbix_repo == "zabbix"

- name: "RedHat | Installing zabbix-java-gateway"
  package:
    pkg: zabbix-java-gateway
    state: "{{ zabbix_javagateway_package_state }}"
    disablerepo: "{{ '*' if (zabbix_repo_yum_enabled | length>0) else omit }}"
    enablerepo: "{{ zabbix_repo_yum_enabled if zabbix_repo_yum_enabled is iterable and (zabbix_repo_yum_enabled | length>0) else omit }}"
  environment:
    http_proxy: "{{ zabbix_http_proxy | default(None) | default(omit) }}"
    https_proxy: "{{ zabbix_https_proxy | default(None) | default(omit) }}"
  register: zabbix_java_gateway_install
  until: zabbix_java_gateway_install is succeeded
  become: true
