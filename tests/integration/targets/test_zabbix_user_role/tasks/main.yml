---
# New user role create test from here
- name: test - Create a new Zabbix role
  zabbix_user_role:
    server_url: "{{ zabbix_api_server_url }}"
    login_user: "{{ zabbix_api_login_user }}"
    login_password: "{{ zabbix_api_login_pass }}"
    state: present
    name: Operators
    type: 1
    rules:
      ui.default_access: 0
      ui:
        - name: "monitoring.hosts"
          status: 0
        - name: "monitoring.maps"
          status: 1
  register: create_zabbix_user_role_result

- assert:
    that:
      - create_zabbix_user_result.changed is sameas true

# Check user role idempotency
- name: test - Update a Zabbix role with same rules
  zabbix_user_role:
    server_url: "{{ zabbix_api_server_url }}"
    login_user: "{{ zabbix_api_login_user }}"
    login_password: "{{ zabbix_api_login_pass }}"
    state: present
    name: Operators
    type: 1
    rules:
      ui.default_access: 0
      ui:
        - name: "monitoring.hosts"
          status: 0
        - name: "monitoring.maps"
          status: 1
  register: create_zabbix_user_role_result

- assert:
    that:
      - create_zabbix_user_result.changed is sameas false

# Check user role change
- name: test - Update a Zabbix role with new rules
  zabbix_user_role:
    server_url: "{{ zabbix_api_server_url }}"
    login_user: "{{ zabbix_api_login_user }}"
    login_password: "{{ zabbix_api_login_pass }}"
    state: present
    name: Operators
    type: 1
    rules:
      ui.default_access: 0
      ui:
        - name: "monitoring.hosts"
          status: 1
        - name: "monitoring.maps"
          status: 0
  register: create_zabbix_user_role_result

- assert:
    that:
      - create_zabbix_user_result.changed is sameas true

# Check user role remove
- name: test - Remote Zabbix role
  zabbix_user_role:
    server_url: "{{ zabbix_api_server_url }}"
    login_user: "{{ zabbix_api_login_user }}"
    login_password: "{{ zabbix_api_login_pass }}"
    state: absent
    name: Operators
  register: create_zabbix_user_role_result

- assert:
    that:
      - create_zabbix_user_result.changed is sameas true

